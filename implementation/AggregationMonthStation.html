<!DOCTYPE html>
<html>
<head>
    <title></title>
</head>
<body>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://d3js.org/queue.v1.min.js"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
<script type="text/javascript" src="../jquery-1.11.0.min.js"></script>
<script src="../libs/FileSaver.js"></script>

<div id="vis"></div>


<script>


    d3.json("../data/allData2003_2004.json",function(error,data){
        //console.log(data);

        var allDates = [];
        var timeParser = d3.time.format("%b %-d, %Y %X %p");
        
        var reducedDataSet = {};

		// go through all ids
        Object.keys(data).forEach(function(id) {
                // add each entry
                for(var i = 0; i < data[id].length; i++) {
                    // update month information
                    var month = timeParser.parse(data[id][i]["date"]).getMonth();

                    // if that month hasn't been logged yet
                    if(!reducedDataSet[month]) {
                        reducedDataSet[month] = {};
                    }
                    
                    // update information for that id
                    if(reducedDataSet[month][id]) {
                        reducedDataSet[month][id]["sum"] += data[id][i]["value"];
                        var hour = timeParser.parse(data[id][i]["date"]).getHours();
                        
                        // if hour hasn't been logged yet
                        if(!reducedDataSet[month][id]["hourly"][hour]) {
                            reducedDataSet[month][id]["hourly"][hour] = data[id][i]["value"];
                        }

                        else {
                            reducedDataSet[month][id]["hourly"][hour] += data[id][i]["value"];
                        }
                    }

                    // if the id is new
                    else {
                        reducedDataSet[month][id] = {"sum" : data[id][i]["value"], "hourly" : {}};
                    }
                }
        });

        console.log(reducedDataSet);

        saveToFile(reducedDataSet,"reducedMonthStationHour2003_2004.json")



    })

    var saveToFile = function(object, filename){
        var blob, blobText;
        blobText = [JSON.stringify(object)];
        blob = new Blob(blobText, {
            type: "text/plain;charset=utf-8"
        });
        saveAs(blob, filename);
    }


</script>


</body>
</html>